# 按文本过滤

扩展提供按文本过滤消息的选项。本文介绍扩展如何将一条消息识别为文本。

使用关键词和使用正则表达式过滤时，扩展将消息转换为文本的规则会略有不同：

* 使用关键词过滤时，扩展使用较为简单的转换规则。转换更易于理解，适合普通用户日常使用；
* 使用正则表达式过滤时，扩展使用较为复杂的转换规则。可以支持更为复杂的过滤规则。

## 识别的部分

内容|文本|正则|说明
----|----|----|----
作者|✗|✓|会在开头添加一个@
正文|✓|✓|见下方详细说明
来源|✗|✓|不包含“来自”字样，有些微博可能没有
时间|✗|✓|使用YYYY-MM-DD"T"HH:mm:ss.sss+0800的格式

按文本过滤时，只有正文部分会被识别，作者、来源和发布时间都不会进入关键字；按正则过滤时，全部上述元素都会被识别。

各部分之间使用一个换行符分割；文本模式下换行符为 U+000A（LF），正则模式下换行符为 U+2028。转发和原微博之间有两个换行符。

### 正文内识别的内容

内容|文本|正则|说明
----|----|----|----
文本|✓|✓|开头结尾的空格被忽略
换行|✓|✓|换行符 LF
提到|✓|✓|@用户名，后面有一个空格
话题<sup>\[1\]</sup>|✓|✓|#话题#，正则时前后有一个空格<br />正则时超话在开头额外有一个U+E627
股票|✓|✓|$股票$，正则时前后有一个空格
链接地址|✗|✓|在链接标题前，可能被 t.cn 缩短过
链接标题|✓|✓|正则时包含链接图标<br />正则时在前后额外有U+FFF9/U+FFFB
表情|✓|✓|\[表情\]

\[1\]: 超话链接作为话题识别，不作为链接识别

----

* 注：本文内容仅限于扩展版，与油猴脚本版无关。
* 注2：扩展尚处于开发过程中，后续可能有向前不兼容的改动。
